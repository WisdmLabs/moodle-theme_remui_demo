{"version":3,"file":"blockmanager.min.js","sources":["../src/blockmanager.js"],"sourcesContent":["/* eslint-disable camelcase */\n/* eslint-disable no-unused-vars */\n/* eslint-disable require-jsdoc */\n/* eslint-disable valid-jsdoc */\n/* eslint-disable */\n\ndefine([\n    'local_edwiserpagebuilder/jquery',\n    'core/ajax', 'core/templates',\n    'core/modal_factory',\n    'core/modal_events',\n    'core/str',\n], function(\n    $,\n    Ajax,\n    Templates,\n     ModalFactory,\n     ModalEvents,\n     Str\n     ) {\n    var refaddBlockModalUrl = '';\n    var blockpagetype = '';\n    const load = () => {\n        $(document).ready(function() {\n            let addblockbutton = \"#epbaddblockbutton\";\n            let epbcustommodal = \".epb_custom_modal.modal\";\n            let epbclosebutton = epbcustommodal + \" .modal-content .close\";\n            let epbcancelbutton = epbcustommodal + \" .modal-content .cancel\";\n            let epbblockupdatebutton = epbcustommodal + \" .modal-content .blocks-list .card-footer .update-content\";\n            let epblayoutupdatebutton = epbcustommodal + \" .modal-content .layout-list .card-footer .update-content\";\n\n            let showLayoutsbutton = epbcustommodal + \" .modal-content .show-layouts\";\n            let showBlocksbutton = epbcustommodal + \" .modal-content .show-blocks\";\n            let layoutContainer = epbcustommodal + \" .modal-body .addblock-modal-body.layout-list\";\n            let blockContainer = epbcustommodal + \" .modal-body .addblock-modal-body.blocks-list\";\n\n            let epbupdateblocklistbtn = epbcustommodal + \" .modal-content .action-buttons-modal .updateblocklist\";\n            let epbupdatelayoutlistbtn = epbcustommodal + \" .modal-content .action-buttons-modal .updatelayoutlist\";\n\n            let epbdeleteblockbtn = blockContainer + \" .card .delete-content\";\n            let epbdeletecardbtn = layoutContainer + \" .card .delete-content\";\n\n            let epblayoutcard = layoutContainer + \" .islayout\";\n\n            let updateinfoalert = '.updateinfoalert';\n            let updateinfoalertext ='.updateinfoalert .updateinfotext';\n            let edwiseradvancedblocktab ='.edwiseradvancedblocktab';\n            let moodleblockstab = '.moodleblockstab';\n\n            $(addblockbutton).on('click', function() {\n                $(epbcustommodal).removeClass('d-none');\n            });\n\n            $(document).on(\"click\", showLayoutsbutton, function() {\n                $(\"#epb_custom_modal .modal-content\").removeClass(\"blocklist\").addClass(\"layoutlist\");\n            });\n            $(document).on(\"click\", showBlocksbutton, function() {\n                $(\"#epb_custom_modal .modal-content\").removeClass(\"layoutlist\").addClass(\"blocklist\");\n            });\n\n            $(document).on(\"click\", epblayoutcard + \" a\", function(e) {\n                e.preventDefault();\n            });\n\n            $(document).on(\"click\", addblockbutton, function() {\n                $(epbcustommodal).removeClass('d-none');\n            });\n\n            $(epbclosebutton + \",\" + epbcancelbutton).on('click', function() {\n                $(epbcustommodal).addClass('d-none');\n            });\n            $(document).on(\"click\", epbblockupdatebutton, function() {\n                updateBlockContent(this, false);\n            });\n            $(document).on(\"click\", epblayoutupdatebutton, function() {\n                updateBlockContent(this, true);\n            });\n\n            function updateBlockContent(ele, islayout) {\n                $(ele).attr('disabled', true);\n                $(ele).find('.edw-icon').addClass(\" rotate\");\n\n                Ajax.call([{\n                    methodname: 'edwiserpagebuilder_update_block_content',\n                    args: {blockname: $(ele).attr(\"data-blockname\"), islayout: islayout},\n                    done: function(data) {\n                        $(ele).find('.edw-icon').removeClass(\"rotate\");\n                        if (data.status == false) {\n                            updateButton(ele);\n                        } else {\n                            $(ele).attr('disabled', false);\n                        }\n                    },\n                    fail: function() {\n                        $(ele).find('.edw-icon').removeClass(\"rotate\");\n                        $(ele).attr('disabled', false);\n                        $(updateinfoalertext).text(\"Something Went Wrong\");\n                        $(updateinfoalert).removeClass('d-none').removeClass('bg-success').addClass('bg-danger');\n                        setTimeout(function(){\n                            $(updateinfoalert).addClass('d-none bg-success').removeClass('bg-danger');\n                        },1500);\n                    }\n                }]);\n            }\n\n            function checkactivetab(){\n                console.log($(edwiseradvancedblocktab).hasClass('active'));\n                return $(edwiseradvancedblocktab).hasClass('active');\n            }\n\n            $(document).on(\"click\", epbupdateblocklistbtn, function() {\n                let _this = this;\n\n                $(_this).attr('disabled', true);\n                $(_this).find('.fa').removeClass('fa-download').addClass(\"fa-refresh rotate\");\n\n                var edwpageurl = $(_this).next().val();\n\n                Ajax.call([{\n                    methodname: 'edwiserpagebuilder_fetch_blocks_list',\n                    args: {\n                        edwpageurl: refaddBlockModalUrl,\n                        contextid: M.cfg.contextid,\n                        blockpage :blockpagetype\n                    },\n                    done: function(data) {\n                        $(_this).find('.fa').removeClass(\"rotate\");\n                        if (data.status == true) {\n                            $(blockContainer + ' [data-parentblock=\"edwiseradvancedblock\"]').remove();\n                            $(blockContainer + ' .block-cards').prepend(data.html);\n                            // updateButton(_this);\n                            $(_this).removeClass('btn-primary').addClass('btn-success d-none');\n                            $(updateinfoalert).removeClass('d-none');\n                            setTimeout(function(){\n                                $(updateinfoalert).addClass('d-none');\n                            },1500);\n                            if(!checkactivetab()){\n                                $('.advanceblockblocks').addClass('d-none');\n                            }\n                        } else {\n                            $(_this).attr('disabled', false);\n                            $(updateinfoalertext).text(\"Something Went Wrong\");\n                            $(updateinfoalert).removeClass('d-none');\n                        }\n                    },\n                    fail: function() {\n                        $(_this).find('.fa').removeClass(\"rotate\");\n                        $(_this).attr('disabled', false);\n                    }\n                }]);\n            });\n\n            $(document).on(\"click\", epbupdatelayoutlistbtn, function() {\n                let _this = this;\n\n                $(_this).attr('disabled', true);\n                $(_this).find('.fa').removeClass('fa-download').addClass(\"fa-refresh rotate\");\n\n                Ajax.call([{\n                    methodname: 'edwiserpagebuilder_fetch_layout_list',\n                    args: {},\n                    done: function(data) {\n                        $(_this).find('.fa').removeClass(\"rotate\");\n                        if (data.status == true) {\n                             $(layoutContainer + ' .block-cards').empty().prepend(data.html);\n                            updateButton(_this);\n                        } else {\n                            $(_this).attr('disabled', false);\n                        }\n                    },\n                    fail: function() {\n                        $(_this).find('.fa').removeClass(\"rotate\");\n                        $(_this).attr('disabled', false);\n                    }\n                }]);\n            });\n\n            $(document).on(\"click\", epbdeleteblockbtn, function() {\n                var id = $(this).data(\"blockid\");\n                delete_content(id, false); // False for block\n            });\n\n            $(document).on(\"click\", epbdeletecardbtn, function() {\n                var id = $(this).data(\"blockid\");\n                delete_content(id, true); // True for layout\n            });\n\n            $(document).on('click', '.block-page-layout-btn', function () {\n                var blockregion = $(this).attr('data-block-region');\n                var blocklayout = $(this).attr('data-block');\n                var blockpagetype = $(this).attr('block-pagetypepattern');\n                var pagesubtype = '';\n                var blockregionvisiblename = blockregion;\n                if ( typeof currentpagesubtype !== 'undefined' ) {\n                    pagesubtype = currentpagesubtype;\n                }\n                if ( typeof regionsnamearray !== 'undefined' ) {\n                    blockregionvisiblename = regionsnamearray[blockregion];\n                }\n                ModalFactory.create({\n                    type: ModalFactory.types.SAVE_CANCEL,\n                    title: Str.get_string('showblocklayoutaddhead', 'local_edwiserpagebuilder'),\n                    body: Str.get_string('showblocklayoutaddbody', 'local_edwiserpagebuilder',blockregionvisiblename),\n                })\n                .done(function (modal) {\n                    modal.setSaveButtonText('Yes');\n                    var root = modal.getRoot();\n                    root.on(ModalEvents.save, function () {\n                        addblockLayout(blocklayout,blockpagetype, blockregion,pagesubtype);\n                    });\n                    modal.show();\n                });\n            });\n\n            /**\n             * @param id\n             * @param islayout\n             */\n            function delete_content(id, islayout) {\n                Ajax.call([{\n                    methodname: 'local_edwiserpagebuilder_delete_block',\n                    args: {id: id, islayout: islayout},\n                    done: function(data) {\n                        if (islayout) {\n                            var element = layoutContainer;\n                        } else {\n                            var element = blockContainer;\n                        }\n                        $(element).find('[data-blockid=\"' + id + '\"]').remove();\n\n                        $(updateinfoalertext).text(\"Successfully deleted!\");\n                        $(updateinfoalert).removeClass('d-none');\n                        setTimeout(function(){\n                            $(updateinfoalert).addClass('d-none');\n                        },1500);\n\n                    },\n                    fail: function(data) {\n                        console.log(\"We are failure\");\n                        console.log(data);\n                        $(updateinfoalertext).text(\"Deletion failure\");\n                        $(updateinfoalert).removeClass('d-none').removeClass('bg-success').addClass('bg-danger');\n                        setTimeout(function(){\n                            $(updateinfoalert).addClass('d-none bg-success').removeClass('bg-danger');\n                        },1500);\n                    }\n                }]);\n            }\n\n            /**\n             * @param button\n             */\n            function updateButton(button) {\n                // $(button).removeClass('btn-primary').addClass('btn-success');\n                $(button).find('.edw-icon').removeClass('edw-icon-Refresh').addClass('edw-icon-Check').css(\"color\", \"green\");\n                // jQuery(button).find('span').html(\"Updated\");\n            }\n\n            function addblockLayout(blocklayout,blockpagetype, blockregion,pagesubtype){\n                Ajax.call([{\n                    methodname: 'local_edwiserpagebuilder_add_adv_block_layout',\n                    args: {\n                        layout: blocklayout,\n                        pagetype: blockpagetype,\n                        region:blockregion,\n                        subpagetypepattern:pagesubtype,\n                        courseid: M.cfg.courseId,\n                        contextinstanceid: M.cfg.contextInstanceId\n                    },\n                    done: function(data) {\n                        if(data.status){\n                            location.reload(true);\n                        }\n                        if(!data.status){\n                            ModalFactory.create({\n                                title: Str.get_string('showblocklayoutaddhead', 'local_edwiserpagebuilder'),\n                                body: data.msg,\n                            })\n                            .done(function (modal) {\n                                modal.show();\n                            });\n                        }\n                    },\n                    fail: function(data) {\n                        console.log(\"We are failure\");\n                        console.log(data);\n                    }\n                }]);\n            }\n        });\n    };\n\n\n    return {\n        // Init: initialize,\n        load: function(addBlockModalUrl, pageType){\n            refaddBlockModalUrl = addBlockModalUrl;\n            blockpagetype = pageType;\n            load();\n        }\n    };\n});\n"],"names":["define","$","Ajax","Templates","ModalFactory","ModalEvents","Str","refaddBlockModalUrl","blockpagetype","load","document","ready","epbcustommodal","layoutContainer","blockContainer","updateinfoalertext","updateBlockContent","ele","islayout","attr","find","addClass","call","methodname","args","blockname","done","data","removeClass","status","updateButton","fail","text","setTimeout","delete_content","id","element","remove","console","log","button","css","on","epblayoutcard","e","preventDefault","epbclosebutton","this","_this","next","val","edwpageurl","contextid","M","cfg","blockpage","prepend","html","hasClass","empty","blockregion","blocklayout","pagesubtype","blockregionvisiblename","currentpagesubtype","regionsnamearray","create","type","types","SAVE_CANCEL","title","get_string","body","modal","setSaveButtonText","getRoot","save","layout","pagetype","region","subpagetypepattern","courseid","courseId","contextinstanceid","contextInstanceId","location","reload","msg","show","addblockLayout","addBlockModalUrl","pageType"],"mappings":"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"}