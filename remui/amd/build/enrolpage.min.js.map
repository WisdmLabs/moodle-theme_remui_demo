{"version":3,"file":"enrolpage.min.js","sources":["../src/enrolpage.js"],"sourcesContent":["/* eslint-disable no-console */\n/* eslint-disable no-unused-vars */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module     theme_remui/enrolpage\n * @copyright (c) 2023 WisdmLabs (https://wisdmlabs.com/)\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/templates',\n    'core/notification',\n    'core_message/message_user_button',\n    'core/custom_interaction_events',\n    'core_message/message_drawer_helper',\n], function(\n    $,\n    Ajax,\n    Templates,\n    Notification,\n    Messageuserbutton,\n    CustomEvents,\n    MessageDrawerHelper) {\n    const linkcoursecontent = '#linkcoursecontent';\n    // Const activeloading = \".loading.active\";\n    const activeloadingpane = \".tab-pane.active.loading\";\n    const loadingnavlink = \".nav-link.loading\";\n    const tabpanearea = \".tab-pane-area\";\n    const enrolinstructorscount = \"#enrol_instructorscount\";\n    const enrollnowbtnform = \"#enroll-now-btn-form\";\n    const enrolbtn = \".enroll-btn-wrapper a.btn\";\n    const showenrollbtn = 'show-enrol-option-btn';\n    const hideenrollbtn = 'hide-enrol-option-btn';\n    const enrollbtnupddropdown = '.enroll-btn-upd-dropdown';\n    const cancelenrolldropdownbtn = '.cancel-enroll-dropdown-btn';\n    const displayException = (ex) => {\n        console.error(ex);\n    };\n\n    const activateContentLoading = (_thispane) => {\n        var serviceName = $(_thispane).attr(\"data-service\");\n        var templateName = $(_thispane).attr(\"data-template\");\n        if (serviceName) {\n            var autoservice = Ajax.call([{\n                methodname: serviceName,\n                args: {courseid: M.cfg.courseId}\n            }]);\n            autoservice[0].done(function(response) {\n                Templates.renderForPromise(templateName, response)\n                    .then(({html, js}) => {\n                        $(_thispane).find(tabpanearea).empty();\n                        Templates.appendNodeContents(_thispane, html, js);\n                        $('.nav-link[href=\"#' + $(_thispane).attr('id') + '\"]').removeClass('loading');\n                        $(_thispane).removeClass('loading');\n                    }).catch(ex => displayException(ex));\n            }).fail(Notification.exception);\n        }\n    };\n\n    // Add functionality to update the enroll now button\n    const updateEnrollNowBtn = (title, link) => {\n        Ajax.call([{\n            methodname: 'theme_remui_enrol_page_action',\n            args: {\n                action: \"update_enroll_now_btn\",\n                config: JSON.stringify({\n                    'courseid': M.cfg.courseId,\n                    'title': title,\n                    'link': link\n                })\n            },\n            done: function(response) {\n                var data = JSON.parse(response);\n                console.log(data.buttontext);\n                console.log(data.buttonlink);\n                $(enrolbtn).text(data.buttontext);\n                // $(enrolbtn).attr('href',data.buttonlink);\n\n            },\n            fail: function (ex) {\n                Notification.exception(ex);\n            }\n        }]);\n\n    };\n\n    // Add functionality to show/hide the enroll option\n    const updateenrolloption = (status) => {\n        Ajax.call([{\n            methodname: 'theme_remui_enrol_page_action',\n            args: {\n                action: \"update_enroll_option\",\n                config: JSON.stringify({\n                    'courseid': M.cfg.courseId,\n                    'enrolloptionshidden': status\n                })\n            },\n            done: function(response) {\n                var data = JSON.parse(response);\n                if(data.enrolloptionshidden){\n                    $('.'+hideenrollbtn).removeClass('d-flex').addClass('d-none');\n                    $('.'+showenrollbtn).removeClass('d-none').addClass('d-flex');\n                    $('.enrol-main-area-wrapper').addClass('d-none');\n                    $('.enrol-mainarea-hidden-contentainer').removeClass('d-none');\n                }else{\n                    $('.'+showenrollbtn).removeClass('d-flex').addClass('d-none');\n                    $('.'+hideenrollbtn).removeClass('d-none').addClass('d-flex');\n                    $('.enrol-main-area-wrapper').removeClass('d-none');\n                    $('.enrol-mainarea-hidden-contentainer').addClass('d-none');\n                }\n            },\n            fail: function (ex) {\n                Notification.exception(ex);\n            }\n        }]);\n\n    };\n\n    const registerCommonEvents = () =>{\n        $(enrolinstructorscount).click(function(e){\n            $('a[href=\"#linkinstructors\"]').tab('show');\n        });\n        $(enrollnowbtnform).submit(function(event) {\n            // Prevent the default form submission\n            event.preventDefault();\n            var buttontext = $(this).find('#enrolbtntext').val();\n            var buttonurl = $(this).find('#enrolbtnurl').val();\n            updateEnrollNowBtn(buttontext, buttonurl);\n            $(enrollbtnupddropdown).removeClass('show');\n        });\n\n        $(enrollbtnupddropdown).on('click.bs.dropdown', function(e) {\n            e.stopPropagation();\n        });\n\n        $(cancelenrolldropdownbtn).on('click', function() {\n            $(enrollbtnupddropdown).removeClass('show');\n        });\n\n        $('.' + showenrollbtn + ', .' + hideenrollbtn).on('click', function (e) {\n            e.preventDefault();\n            // Check the class of the clicked button\n            if ($(this).hasClass(showenrollbtn)) {\n                updateenrolloption(false);\n\n            } else if ($(this).hasClass(hideenrollbtn)) {\n                updateenrolloption(true);\n            }\n          });\n\n        // Handle messagin feature in instructor tab.\n        $(document).on('click','.enrol-instructor-msg-btn',  function (e) {\n            var element = $(this);\n            if($(this).hasClass('active')){\n                MessageDrawerHelper.hide();\n                $(this).removeClass('active');\n            }\n            else{\n                $('.enrol-instructor-msg-btn').removeClass('active');\n                $(this).addClass('active');\n                var args = {\n                    conversationid: parseInt(element.attr('data-conversationid')),\n                    buttonid: element.attr('id'),\n                    userid: parseInt(element.attr('data-userid'))\n                };\n                if (args.conversationid) {\n                    MessageDrawerHelper.showConversation(args);\n                } else {\n                    MessageDrawerHelper.createConversationWithUser(args);\n                }\n            }\n        });\n         // Pause video when the modal is closed\n        $(document).on('click','.modal-close-btn, .modal', function () {\n            var video = document.getElementById('customfieldinfovideo');\n            video.pause();\n            video.currentTime = 0;\n        });\n    };\n    return {\n        init: function() {\n            $(document).ready(function() {\n                activateContentLoading(activeloadingpane);\n                $(document).on('click', loadingnavlink, function() {\n                    var loadContentForPane = $(this).attr(\"href\");\n                    activateContentLoading(loadContentForPane);\n                });\n            });\n            registerCommonEvents();\n        }\n    };\n});\n"],"names":["define","$","Ajax","Templates","Notification","Messageuserbutton","CustomEvents","MessageDrawerHelper","showenrollbtn","hideenrollbtn","activateContentLoading","_thispane","serviceName","attr","templateName","call","methodname","args","courseid","M","cfg","courseId","done","response","renderForPromise","then","_ref","html","js","find","empty","appendNodeContents","removeClass","catch","ex","console","error","displayException","fail","exception","updateenrolloption","status","action","config","JSON","stringify","parse","enrolloptionshidden","addClass","registerCommonEvents","click","e","tab","submit","event","preventDefault","title","link","buttontext","this","val","buttonurl","data","log","buttonlink","text","on","stopPropagation","hasClass","document","element","hide","conversationid","parseInt","buttonid","userid","showConversation","createConversationWithUser","video","getElementById","pause","currentTime","init","ready","loadContentForPane"],"mappings":"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"}